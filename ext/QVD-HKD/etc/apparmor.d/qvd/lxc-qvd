# Do not load this file.  Rather, load /etc/apparmor.d/lxc-containers, which
# will source all profiles under /etc/apparmor.d/lxc
#include <tunables/global>

profile lxc-container-qvd flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>
  #include <abstractions/qvd/container-base-qvd>

  # the container may never be allowed to mount devpts.  If it does, it
  # will remount the host's devpts.  We could allow it to do it with
  # the newinstance option (but, right now, we don't).
  deny mount fstype=devpts,
  mount fstype=configfs,
  mount fstype=cgroup -> /sys/fs/cgroup/**,
  # Allowed mount options
  mount options=(rw, rslave),
  mount options=(rw, rbind),
  mount options=(rw, rshared),
  mount options=(ro, remount, bind),
  mount options=(ro, nosuid, nodev, remount, bind),
  mount options=(ro, nosuid, nodev, noexec, remount, bind),
  mount options=(ro, nosuid, noexec, remount, bind),
  # Cgroup2 mount and mount options
  mount options=(rw, nosuid, nodev, noexec),
  mount fstype=cgroup2 -> /sys/fs/cgroup/**,
}
